# Концепция реализации SpecRails как MCP-сервиса

**Версия:** 1.0
**Статус:** Идея для обсуждения
**Дата:** 2025-11-15

## 1. Цель документа

Этот документ фиксирует высокоуровневое видение архитектуры SpecRails как **клиент-серверного приложения (MCP)**. Он служит резюме наших обсуждений и основой для дальнейшего проектирования и разработки.

Ключевой принцип: **разрабатывать локально, но проектировать для раздельного развертывания.**

## 2. Резюме принятых решений

### 2.1. Архитектура: Клиент-Сервер

Система будет состоять из двух четко разделенных частей:

*   **MCP-Сервер (Backend):** "Мозг" системы, содержащий всю бизнес-логику.
*   **Клиент (Frontend):** "Глупый" пользовательский интерфейс, взаимодействующий с сервером по API.

Это позволяет конечным пользователям (аналитикам) работать с удобным UI, не разворачивая у себя всю сложную серверную часть.

### 2.2. Централизованный рендеринг `Preview`

Логика визуализации DSL (генерация `Preview`) полностью находится на сервере. Клиент лишь запрашивает и отображает готовый HTML, что гарантирует единообразие отображения на любой платформе.

### 2.3. Опциональность `Preview`

`Preview` не является обязательным шагом. Основной результат работы системы — это структурированный DSL (YAML/JSON). Визуализация запрашивается аналитиком отдельно и по необходимости.

## 3. Описание компонентов

### 3.1. MCP-Сервер (Backend)

*   **Ответственность:**
    *   Предоставление HTTP API.
    *   Исполнение логики слоев `Core`, `Process` и `Governance`.
    *   Взаимодействие с внешними AI-моделями.
    *   Валидация DSL по JSON-схемам.
    *   Генерация HTML для `Preview` по запросу.
*   **Предлагаемый стек:**
    *   **Среда:** Node.js
    *   **Язык:** TypeScript
    *   **API-фреймворк:** Express.js или Fastify
    *   **Валидация:** Ajv
    *   **Парсинг:** `yaml`

### 3.2. Клиент (Frontend)

*   **Ответственность:**
    *   Предоставление UI для ввода текста аналитиком.
    *   Отправка запросов на MCP-сервер.
    *   Отображение полученного результата:
        *   Текстового DSL.
        *   Ошибок валидации.
        *   HTML-представления `Preview` (в Webview).
*   **Примеры реализации:**
    *   Расширение для VS Code.
    *   Веб-приложение.

## 4. Ключевые сценарии взаимодействия

1.  **Генерация и Валидация DSL:**
    *   Клиент отправляет текстовый запрос на сервер.
    *   Сервер выполняет полный цикл: `AI Agent` → `Validator`.
    *   Сервер возвращает клиенту ответ с валидированным DSL.

2.  **Запрос `Preview` (опционально):**
    *   Клиент отправляет **дополнительный, отдельный запрос** на сервер, передавая в нем ранее полученный DSL.
    *   Сервер рендерит HTML и возвращает его клиенту.
    *   Клиент отображает HTML в специальном окне (Webview).

## 5. Вывод для разработки MVP

При разработке MVP мы будем создавать пакеты (`@specrails/core`, `@specrails/process`) как независимые модули. Это позволит нам сначала отладить их локально, а затем легко интегрировать в серверное приложение, которое будет предоставлять API для "глупых" клиентов.


