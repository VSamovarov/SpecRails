# üîÑ **SpecRails AI Interaction Protocols & Communication Contracts**

## üéØ –¶–µ–ª—å

> –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É SpecRails –∏ AI-–∞–≥–µ–Ω—Ç–∞–º–∏, –æ–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–π, –º–µ—Ö–∞–Ω–∏–∑–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, —Ñ–æ—Ä–º–∞—Ç—ã –æ–±–º–µ–Ω–∞ –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å.

---

## üß© 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                              |
| -------------------------- | ----------------------------------------------------------------------- |
| **AI Session Manager**     | –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –¥–∏–∞–ª–æ–≥–∞ —Å AI, —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—é     |
| **Prompt I/O Handler**     | –§–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã AI –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤        |
| **Communication Contract** | –§–æ—Ä–º–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É SpecRails –∏ AI           |
| **Error Frame System**     | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞                  |
| **Recovery Stream**        | –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

---

## üß† 2. –¶–µ–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

1. –°–¥–µ–ª–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ AI ‚Üî SpecRails –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.
2. –ò—Å–∫–ª—é—á–∏—Ç—å ¬´—Å—é—Ä–ø—Ä–∏–∑—ã¬ª –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî –ª—é–±–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.
3. –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–º—ã—Å–ª–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: –∫–æ–º–∞–Ω–¥—ã, –¥–∞–Ω–Ω—ã–µ, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç.
4. –°–≤–µ—Å—Ç–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–æ–∫ AI –∫ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º.
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥–æ–≤—ã–π –ø–æ—Ç–æ–∫ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

## ‚öôÔ∏è 3. –¢–∏–ø—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

| –¢–∏–ø                   | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –ü—Ä–∏–º–µ—Ä                             |
| --------------------- | ----------------------------------------------------- | ---------------------------------- |
| **Command Exchange**  | –ó–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π –∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏                         | `generate form for entity=student` |
| **Data Exchange**     | –ü–µ—Ä–µ–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (DSL, schema)       | YAML/JSON —Ñ–æ—Ä–º—ã                    |
| **Meta Exchange**     | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π, –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –≤–µ—Ä—Å–∏—è–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ | `switch contract=form.contract.v2` |
| **Feedback Exchange** | –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–ª–∏ Core                  | `revise field labels for clarity`  |
| **Recovery Exchange** | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ –∏–ª–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–π        | `retry using schema patch`         |

---

## üß± 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Communication Contract

```yaml
communication_contract:
  id: "specrails.ai.protocol.v1"
  supported_types: ["command", "data", "meta", "feedback", "recovery"]
  message_format: "json"
  schema_version: "1.0"
  required_fields: ["type", "payload", "timestamp"]
  error_handling:
    - type: "schema_violation"
      action: "retry_with_fix"
    - type: "timeout"
      action: "switch_model"
```

---

## üß© 5. –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π (Prompt I/O Frame)

```yaml
message:
  id: "req-2025-1106-0045"
  type: "command"
  contract_id: "form.contract.v2"
  payload:
    instruction: "Generate a registration form for student entity"
    context_ref: "ctx-education-0023"
  meta:
    ai_model: "gpt-5"
    user: "analyst_viktor"
    locale: "ru"
  timestamp: "2025-11-06T22:41:00Z"
```

---

## üß© 6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (AI Response Frame)

```yaml
response:
  id: "res-2025-1106-0045"
  status: "success"
  payload:
    dsl:
      form:
        title: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞"
        fields:
          - name: "firstName"
            type: "string"
          - name: "age"
            type: "number"
  meta:
    model: "gpt-5"
    contract_used: "form.contract.v2"
    validation: "passed"
    retry_count: 0
  duration_ms: 2140
```

---

## ‚ö†Ô∏è 7. Error Frame System

| –ö–æ–¥      | –¢–∏–ø –æ—à–∏–±–∫–∏                | –î–µ–π—Å—Ç–≤–∏–µ                                |
| -------- | ------------------------- | --------------------------------------- |
| **E001** | Schema violation          | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞      |
| **E002** | Context mismatch          | –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å |
| **E003** | AI response invalid       | –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å fallback –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º  |
| **E004** | Timeout                   | –°–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É   |
| **E005** | Human correction required | –ü–µ—Ä–µ–¥–∞—Ç—å –≤ Feedback Loop                |

–ü—Ä–∏–º–µ—Ä:

```yaml
error_frame:
  id: "err-2025-1106-0046"
  code: "E003"
  message: "Response does not conform to schema"
  recovery_action: "use backup contract"
  contract_fallback: "form.contract.v1"
```

---

## üîÅ 8. Recovery Stream

**Recovery Stream** ‚Äî —ç—Ç–æ –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:

```mermaid
graph TD
A[Error Frame Detected] --> B[Select Recovery Strategy]
B --> C[Retry with Adjusted Prompt]
C --> D[Validate Response]
D -->|Success| E[Return Result]
D -->|Fail| F[Escalate to Feedback Loop]
```

Recovery Stream –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å **Execution Runtime**, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã fallback-–ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ **Error Governance**.

---

## üß† 9. Session Context Protocol

–°–µ—Å—Å–∏—è AI —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ü–µ–ø–æ—á–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

```yaml
session_context:
  session_id: "sess-education-0014"
  user: "analyst_viktor"
  active_contract: "form.contract.v2"
  ai_model: "gpt-5"
  messages_count: 14
  last_command: "generate model for guardian entity"
  runtime_memory:
    - last_schema_ref: "spec.form.v1.json"
    - last_drift_score: 0.018
```

---

## üìä 10. –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞                     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                        |
| --------------------------- | ------------------------------------------------- |
| **Message Latency**         | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ AI                           |
| **Response Validity Rate**  | % –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ —Å—Ö–µ–º–µ                     |
| **Error Frequency**         | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –Ω–∞ 100 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π           |
| **Recovery Success Rate**   | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è      |
| **Session Stability Index** | –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è AI –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ |

---

## üß≠ 11. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø

> **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å AI ‚Äî —ç—Ç–æ –Ω–µ –¥–∏–∞–ª–æ–≥, –∞ –ø—Ä–æ—Ç–æ–∫–æ–ª.**
> SpecRails –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ AI –∫–∞–∫ –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –∞ –Ω–µ –∫–∞–∫ –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É.
> –ö–∞–∂–¥—ã–π –æ–±–º–µ–Ω ‚Äî —ç—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –ø–æ–¥—á–∏–Ω—ë–Ω–Ω–∞—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É, –ø—Ä–æ–≤–µ—Ä—è–µ–º–∞—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–∞—è –ø—Ä–∏ —Å–±–æ—è—Ö.
> –¢–æ–ª—å–∫–æ —Ç–∞–∫ –º–æ–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –ø—Ä–æ—Ü–µ—Å—Å.
