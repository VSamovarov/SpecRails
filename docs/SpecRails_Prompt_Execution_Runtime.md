# ‚öôÔ∏è **SpecRails Prompt Execution Runtime**

## üéØ –¶–µ–ª—å

> –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ —è–¥—Ä–æ SpecRails –≤—ã–ø–æ–ª–Ω—è–µ—Ç Prompt Contracts –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ AI-–∞–≥–µ–Ω—Ç—É, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å, –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

–≠—Ç–æ—Ç —Å–ª–æ–π ‚Äî ¬´–º–æ—Ç–æ—Ä¬ª Prompt Governance System: –æ–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –≤—ã–∑–æ–≤—ã AI, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ—Ç—Ä–∞–µ–≤ –∏ —Ñ–∏–¥–±—ç–∫–∞, –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üß© 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                           |
| --------------------- | ------------------------------------------------------------------------------------ |
| **Prompt Runner**     | –ò—Å–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç: —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ AI, –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç         |
| **Execution Context** | –°–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–∑–æ–≤–∞ (–∫–æ–Ω—Ç–µ–∫—Å—Ç, –≤–µ—Ä—Å–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, AI-–º–æ–¥–µ–ª—å)                    |
| **Validator**         | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç AI —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π —Å—Ö–µ–º–µ                                |
| **Feedback Loop**     | –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å —Å —É—á—ë—Ç–æ–º –∑–∞–º–µ—á–∞–Ω–∏–π –∏–ª–∏ –æ—à–∏–±–æ–∫                             |
| **Cache Layer**       | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤                       |
| **Fallback Policy**   | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ–Ω—Ç—Ä–∞–∫—Ç, —Å—Ç–∞—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç) |

---

## üß† 2. –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```mermaid
graph TD
A[Execution Request] --> B[Select Prompt Contract]
B --> C[Prepare Context]
C --> D[Send to AI Agent]
D --> E[Validate Output]
E -->|Valid| F[Cache & Return Result]
E -->|Invalid| G[Feedback Loop]
G --> D
F --> H[SpecRails Core]
```

---

## ‚öôÔ∏è 3. Execution Context

```yaml
execution_context:
  contract_id: "form.contract.v2"
  ai_model: "gpt-5"
  input_text: "–°–æ–∑–¥–∞–π —Ñ–æ—Ä–º—É –ø—Ä–æ—Ñ–∏–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞"
  project: "education"
  locale: "ru"
  version: "2.1.0"
  retries: 0
```

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —è–¥—Ä–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Audit Trail –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏.

---

## üîÅ 4. –ú–µ—Ö–∞–Ω–∏–∑–º Feedback Loop

| –°–æ–±—ã—Ç–∏–µ             | –î–µ–π—Å—Ç–≤–∏–µ                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| ------------------- | ------------------------------------------------- | ----------------------------------------------------------- |
| **Invalid Output**  | –ü–æ–≤—Ç–æ—Ä —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                     | AI –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É: "output invalid ‚Äî fix schema errors" |
| **Partial Success** | –ü–æ–≤—Ç–æ—Ä —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤–∞–ª–∏–¥–Ω—ã—Ö —á–∞—Å—Ç–µ–π              | –¢–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é     |
| **Human Feedback**  | –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –ø–æ –∑–∞–º–µ—á–∞–Ω–∏—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | –ê–Ω–∞–ª–∏—Ç–∏–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–µ —Ç–∞–∫ ‚Äî AI –æ–±–Ω–æ–≤–ª—è–µ—Ç DSL           |
| **Timeout**         | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –∫–æ–Ω—Ç—Ä–∞–∫—Ç                    | Runtime –≤—ã–±–∏—Ä–∞–µ—Ç –∑–∞–ø–∞—Å–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç                          |

---

## üíæ 5. Cache Layer

| –¢–∏–ø –∫–µ—à–∞             | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ                              | TTL    |
| -------------------- | --------------------------------------- | ------ |
| **Prompt Cache**     | –•—Ä–∞–Ω–∏—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–º—Ç—ã –∏ –æ—Ç–≤–µ—Ç—ã AI      | 24 —á   |
| **Validation Cache** | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ DSL       | 72 —á   |
| **Feedback Cache**   | –•—Ä–∞–Ω–∏—Ç –æ—à–∏–±–æ—á–Ω—ã–µ –∫–µ–π—Å—ã –∏ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | 7 –¥–Ω–µ–π |

> **–ü—Ä–∞–≤–∏–ª–æ:** –∫–µ—à–∏ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –Ω–æ –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.

---

## üîê 6. Fallback Policy

```yaml
fallback_policy:
  order:
    - retry_contract: "form.contract.v1"
    - retry_model: "gpt-4"
    - use_static_template: true
  max_retries: 3
  delay_between_retries: 5s
```

Fallback –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –µ—Å–ª–∏ AI –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è, SpecRails –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–ª–∏ –º–æ–¥–µ–ª—å, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

---

## üß± 7. Validator

Validator ‚Äî –∫–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç Runtime. –û–Ω:

* —Å–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI —Å JSON Schema;
* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π;
* –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, YAML ‚Üí JSON);
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—á—ë—Ç –æ–± –æ—à–∏–±–∫–∞—Ö –≤ Feedback Loop.

```yaml
validation_result:
  valid: false
  errors:
    - path: "/fields/0/type"
      message: "unknown type 'dropdownx'"
```

---

## üß≠ 8. Execution Policy Levels

| –£—Ä–æ–≤–µ–Ω—å         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                         | –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫             |
| --------------- | -------------------------------------------------- | ------------------------- |
| **Strict**      | –í–∞–ª–∏–¥–∞—Ü–∏—è –∂—ë—Å—Ç–∫–∞—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è  | DSL generation core       |
| **Adaptive**    | AI –º–æ–∂–µ—Ç –≤–Ω–µ—Å—Ç–∏ –ø—Ä–∞–≤–∫–∏ –ø–æ—Å–ª–µ –∑–∞–º–µ—á–∞–Ω–∏–π             | preview / visual feedback |
| **Exploratory** | –†–∞–∑—Ä–µ—à–µ–Ω—ã –≤–∞—Ä–∏–∞—Ü–∏–∏ –ø—Ä–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö | sandbox mode              |

---

## üìä 9. –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞                  | –û–ø–∏—Å–∞–Ω–∏–µ                                                 |
| ------------------------ | -------------------------------------------------------- |
| **Success Rate**         | –î–æ–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π –±–µ–∑ —Ä–µ—Ç—Ä–∞–µ–≤                      |
| **Avg Retry Depth**      | –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞         |
| **Cache Hit Ratio**      | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è                                |
| **AI Drift Index**       | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –≤—ã–≤–æ–¥–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —ç—Ç–∞–ª–æ–Ω–æ–º |
| **Human Feedback Ratio** | –î–æ–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º           |

---

## üß© 10. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø

> **Prompt Execution Runtime ‚Äî —ç—Ç–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–∏—Ä—É—é—â–∏–π —Å–ª–æ–π –Ω–∞–¥ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–º AI.**
> –û–Ω –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É AI —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–æ–π –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π.

SpecRails Runtime –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å AI —É–º–Ω–µ–µ ‚Äî –æ–Ω –¥–µ–ª–∞–µ—Ç –µ–≥–æ **–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º** –≤ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
