version: 1.0  
status: active  
prepared_by: AI Agent  
last_updated: 2025-11-11  

# üß© SpecRails Architecture Improvement Plan

## üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã SpecRails —Å —É—á—ë—Ç–æ–º –∞–Ω–∞–ª–∏–∑–∞ –º–æ–¥—É–ª—å–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü, —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ (Core / Process / Governance), —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤.  
–î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–≤ –∏ AI-–∞–≥–µ–Ω—Ç–æ–≤, —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π.

---

## 1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ú–æ–¥—É–ª—å | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ |
|------------|--------|-----------|--------------------------|
| üî¥ High | **Parser ‚Üî Prompt Registry** | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ | –í–Ω–µ–¥—Ä–∏—Ç—å `PromptManifestDTO` –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö |
| üî¥ High | **Validation Loop** | –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å `ValidationState` enum –∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ |
| üî¥ High | **Governance ‚Üî Observability** | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–º–∫–Ω—É—Ç—ã–π –∫–æ–Ω—Ç—É—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ | –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º `Policy Hook` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ |
| üü† Medium | **Orchestrator** | –ù–µ—è–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏ | –û–ø–∏—Å–∞—Ç—å —Ä–æ–ª–∏ –∞–≥–µ–Ω—Ç–æ–≤ (Parser, Validator, Analyst) –∏ Event Bus |
| üü° Low | **Terminology_Glossary** | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ | –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω—ã: Manifest Lifecycle, Policy Hook, Agent State, Sandbox Context |

---

## 2. –ü–ª–∞–Ω —Ä–∞–±–æ—Ç –ø–æ —ç—Ç–∞–ø–∞–º

### –≠—Ç–∞–ø 1 ‚Äî –§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü (Core Layer)
**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É Parser –∏ Prompt Registry.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å `schemas/PromptManifestDTO.json` ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
2. –û–±–Ω–æ–≤–∏—Ç—å `Terminology_Glossary.md`:
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω **Prompt Manifest DTO**
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω **Manifest Lifecycle**
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø: Parser —Å–æ–∑–¥–∞—ë—Ç DTO, Registry —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** Parser –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Registry API

---

### –≠—Ç–∞–ø 2 ‚Äî –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è Validation Loop (Process Layer)
**–¶–µ–ª—å:** –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—É—é –º–æ–¥–µ–ª—å.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å `ValidationState` enum (generating, validating, previewing, reviewing, approved, rejected)
2. –û–ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
3. –í–∫–ª—é—á–∏—Ç—å Preview –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é UX-—Ñ–∞–∑—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `Terminology_Glossary.md` —Ç–µ—Ä–º–∏–Ω—ã:
   - **Validation State**
   - **Agent State**

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∏–º–µ–µ—Ç —è–≤–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (Parser, Validator, Analyst, Orchestrator)

---

### –≠—Ç–∞–ø 3 ‚Äî –ó–∞–º—ã–∫–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (Governance Layer)
**–¶–µ–ª—å:** –°–¥–µ–ª–∞—Ç—å Governance —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º –Ω–∞ –¥–∞–Ω–Ω—ã–µ Observability.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º `Policy Hook` –≤ `Terminology_Glossary.md`
2. –û–ø–∏—Å–∞—Ç—å —Å—Ö–µ–º—É: `Observability ‚Üí Policy Hook ‚Üí Governance ‚Üí Validation Loop`
3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã (drift_index, validation_failure_rate) –∏ –¥–µ–π—Å—Ç–≤–∏—è (require_review, disable_auto_merge)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** Governance –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–µ—Ç—Ä–∏–∫

---

### –≠—Ç–∞–ø 4 ‚Äî –£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –≤ Orchestrator (Process Layer)
**–¶–µ–ª—å:** –û–ø–∏—Å–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª–∏ –∞–≥–µ–Ω—Ç–æ–≤: Parser, Validator, Analyst
2. –û–ø–∏—Å–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é Event Bus –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω **Sandbox Context** –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ Orchestrator –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∞–≥–µ–Ω—Ç–æ–≤ –±–µ–∑ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Ä–µ–≤—å—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –Ø–¥—Ä–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ (Core –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç Environment).
- –í—Å–µ AI-–≤—ã–∑–æ–≤—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Validation Loop.
- Feedback –∑–∞–º–∫–Ω—É—Ç –Ω–∞ Governance –∏ Observability.
- –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞.
- –ö–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞:
  - `Dependencies`
  - `Related Documents`
  - `Key Concepts`

---

## 4. –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ—Å—Ç–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –°—Ç–∞—Ç—É—Å |
|------------|----------|------|--------|
| –§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ | `PromptManifestDTO.json` —Å–æ–∑–¥–∞–Ω | 1 —Ñ–∞–π–ª | ‚è≥ Pending |
| –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è | –ù–æ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ Glossary | 6 —Ç–µ—Ä–º–∏–Ω–æ–≤ | ‚è≥ Pending |
| –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è | ValidationState –æ–ø—Ä–µ–¥–µ–ª—ë–Ω | 6 —Å–æ—Å—Ç–æ—è–Ω–∏–π | ‚è≥ Pending |
| Governance Loop | Policy Hook –æ–ø–∏—Å–∞–Ω | 1 –º–µ—Ö–∞–Ω–∏–∑–º | ‚è≥ Pending |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å | –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏–∑ Review Report | 5 –ø—É–Ω–∫—Ç–æ–≤ | ‚è≥ Pending |

---

## 5. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –û–±–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (AI review agent).
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `docs_refactored/`.
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–≤—å—é —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Å–æ–≤–µ—Ç–æ–º.

---
